<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
		<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
		<script>$(document).bind('mobileinit',function() { $.mobile.pushStateEnabled = false; });</script> <!-- Chrome Security override -->
		<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
		<script src='js/spectrum.min.js'></script> <!-- http://bgrins.github.io/spectrum -->
		<link rel='stylesheet' href='css/spectrum.min.css' />
		<style type="text/css">
			.ui-header .ui-title {margin-right: 1%; margin-left: 1%;}
		</style>
		<title>Configuration</title>
	</head>

	<body>
		<div data-role="page" name="page1" id="page1">
			<div data-role="header" data-id="header" data-theme="b" data-position="fixed" style="background: #3388cc">
				<h1>Configuration</h1>
			</div>		
			<div data-role="content" style="margin:0 auto;margin-left:auto;margin-right:auto;align:center;text-align:center;">
				<div data-role="collapsible" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" data-mini="true" data-collapsed="false">
					<h4>General</h4>
					<fieldset class="ui-grid-a">
						<div class="ui-block-a">
							<legend>Clock Format:</legend>
							<select name="c_ampm" id="c_ampm" data-background="" data-role="slider">
								<option value="12h">12h</option>
								<option value="24h" selected="">24h</option>
							</select>
						</div>
						<div class="ui-block-b"> 
							<legend>Smart Status:</legend>
							<select name="c_smart" id="c_smart" data-background="" data-role="slider">
								<option value="0">No</option>
								<option value="1" selected="">Yes</option>
							</select>
						</div>
					</fieldset>
				</div>
				<div data-role="collapsible" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" data-mini="true" data-collapsed="false">
					<h4>Calendar</h4>
					<fieldset class="ui-grid-a">
						<div class="ui-block-a">
							<legend>1st Weekday:</legend>
							<select name="c_firstwd" id="c_firstwd" data-background="" data-role="slider">
								<option value="so">So</option>
								<option value="mo" selected="">Mo</option>
							</select>
						</div>
						<div class="ui-block-b"> 
							<legend>Show Grid:</legend>
							<select name="c_grid" id="c_grid" data-background="" data-role="slider">
								<option value="0">No</option>
								<option value="1" selected="">Yes</option>
							</select>
						</div>
					</fieldset>
					<fieldset class="ui-grid-a">
						<div class="ui-block-a">
							<legend>Invert today:</legend>
							<select name="c_invert" id="c_invert" data-background="" data-role="slider">
								<option value="0">No</option>
								<option value="1" selected="">Yes</option>
							</select>
						</div>
						<div class="ui-block-b"> 
							<legend>Show Month, Year:</legend>
							<select name="c_showmy" id="c_showmy" data-background="" data-role="slider">
								<option value="0">No</option>
								<option value="1" selected="">Yes</option>
							</select>
						</div>
					</fieldset>
					<fieldset class="ui-grid-a">
						<div class="ui-block-a">
							<legend>Show Week#:</legend>
							<select name="c_showwn" id="c_showwn" data-background="" data-role="slider">
								<option value="0">No</option>
								<option value="1" selected="">Yes</option>
							</select>
						</div>
						<div class="ui-block-b"> 
							<legend>Week# Offset:</legend>
							<select name="c_wnoffs" id="c_wnoffs" data-mini="true">
								<option value="-2">-2</option>
								<option value="-1">-1</option>
								<option value="0" selected="">0</option>
								<option value="1">1</option>
								<option value="2">2</option>								
							</select>
						</div>
					</fieldset>
					<fieldset data-role="controlgroup" data-mini="true">
						<legend>Weeks to Show:</legend>
						<input type="radio" name="c_preweeks" id="c_preweeks1" value="1" checked="checked">
						<label for="c_preweeks1">Previous, Current, Next</label>
						<input type="radio" name="c_preweeks" id="c_preweeks2" value="2">
						<label for="c_preweeks2">Two Previous, Current</label>
						<input type="radio" name="c_preweeks" id="c_preweeks3" value="0">
						<label for="c_preweeks3">Current, Two Next</label>
					</fieldset>
				</div>
				<div data-role="collapsible" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" data-mini="true" data-collapsed="false">
					<h4>Weather</h4>
					<fieldset class="ui-grid-a">
						<div class="ui-block-a"> 
							<legend>Show Weather:</legend>
							<select name="c_weather" id="c_weather" data-background="" data-role="slider">
								<option value="0">No</option>
								<option value="1" selected="">Yes</option>
							</select>
						</div>
						<div class="ui-block-b"> 
							<legend>Units:</legend>
							<select name="c_units" id="c_units" data-background="" data-role="slider">
								<option value="f">°F</option>
								<option value="c" selected="">°C</option>
							</select>
						</div>
					</fieldset>
					<fieldset class="ui-grid-a">
						<div class="ui-block-a"> 
							<legend>Weather Forecast:</legend>
							<select name="c_weather_fc" id="c_weather_fc" data-background="" data-role="slider">
								<option value="0">No</option>
								<option value="1" selected="">Yes</option>
							</select>
						</div>
						<div class="ui-block-b"> 
							<legend>Auto slide out</legend>
							<select name="c_weather_aso" id="c_weather_aso" data-background="" data-role="slider">
								<option value="0">No</option>
								<option value="1" selected="">Yes</option>
							</select>
						</div>
					</fieldset>
					<fieldset class="ui-grid-a">
						<div class="ui-block-a"> 
							<legend>Update Frequency:</legend>
							<select name="c_update" id="c_update" data-mini="true">
								<option value="0">Disabled</option>
								<option value="15">15 minutes</option>
								<option value="30">30 minutes</option>
								<option value="60" selected="selected">1 hour</option>
							</select>
						</div>
						<!--div class="ui-block-b"> 
							<legend>Data Provider:</legend>
							<select name="c_provider" id="c_provider" data-mini="true">
								<option value="owm">openweathermap</option>
								<option value="yah">yahoo weather</option>
							</select>
						</div-->
					</fieldset>
					<fieldset class="ui-grid-a">
						<div class="ui-corner-all custom-corners" data-mini="true">
							<div class="ui-bar ui-bar-a">
								<h3>City ID or zero for auto location</h3>
							</div>
							<div class="ui-block-a" style="width:85%"> 
								<input type="number" data-clear-btn="true" name="c_cityid" pattern="[0-9]*" id="c_cityid" value="0" data-mini="true">
							</div>
							<div class="ui-block-b" style="width:15%"> 
								<!--a href="#overlay" data-rel="popup" data-role="button" data-icon="info" data-mini="true" data-inline="true" data-iconpos="notext" data-position-to="window" data-overlay-theme="a"  data-transition="flow"></a>
								<div id="overlay" data-role="popup" data-overlay-theme="a" class="ui-content">
									<p>Both <strong>http://openweathermap.org</strong> as well as <strong>http://weather.yahoo.com</strong> you go to the page and search for your town, the City ID is in each case the number on the far right in the address bar. The ID works only for the appropriate provider.</p>
								</div-->
							</div>
						</div>
					</fieldset>
				</div>
				<div data-role="collapsible" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" data-mini="true" data-collapsed="false">
					<h4>Colors (Hint: long press)</h4>
					<fieldset class="ui-grid-a">
						<div class="ui-block-b">
							<legend>Background: </legend>
							<input type='text' id="c_col_bg" />
						</div>
						<div class="ui-block-b">
							<legend>Calendar BG: </legend>
							<input type='text' id="c_col_calbg" />
						</div>
						<div class="ui-block-b">
							<legend>Calendar Grid: </legend>
							<input type='text' id="c_col_calgr" />
						</div>
						<div class="ui-block-b">
							<legend>Calendar Text: </legend>
							<input type='text' id="c_col_caltx" />
						</div>
						<div class="ui-block-b">
							<legend>Week Number: </legend>
							<input type='text' id="c_col_calwn" />
						</div>
						<div class="ui-block-b">
							<legend>Calendar HL: </legend>
							<input type='text' id="c_col_calhl" />
						</div>
						<div class="ui-block-b">
							<legend>Month/Year: </legend>
							<input type='text' id="c_col_calmy" />
						</div>
					</fieldset>
 				</div>
				<div data-role="collapsible" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" data-mini="true" data-collapsed="false">
					<h4>Vibration</h4>
					<fieldset class="ui-grid-a">
						<div class="ui-block-a"> 
							<legend>Enable Vibration:</legend>
							<select name="c_vibr_all" id="c_vibr_all" data-background="" data-role="slider">
								<option value="0">No</option>
								<option value="1" selected="">Yes</option>
							</select>
						</div>
						<div class="ui-block-b"> 
							<legend>Quiet Time:</legend>
							<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
								<select name="c_quietf" id="c_quietf">
									<option value="0">00h</option>
									<option value="1">01h</option>
									<option value="2">02h</option>
									<option value="3">03h</option>
									<option value="4">04h</option>
									<option value="5">05h</option>
									<option value="6">06h</option>
									<option value="7">07h</option>
									<option value="8">08h</option>
									<option value="9">09h</option>
									<option value="10">10h</option>
									<option value="11">11h</option>
									<option value="12">12h</option>
									<option value="13">13h</option>
									<option value="14">14h</option>
									<option value="15">15h</option>
									<option value="16">16h</option>
									<option value="17">17h</option>
									<option value="18">18h</option>
									<option value="19">19h</option>
									<option value="20">20h</option>
									<option value="21">21h</option>
									<option value="22" selected="selected">22h</option>
									<option value="23">23h</option>
								</select>
								<select name="c_quiett" id="c_quiett">
									<option value="0">00h</option>
									<option value="1">01h</option>
									<option value="2">02h</option>
									<option value="3">03h</option>
									<option value="4">04h</option>
									<option value="5">05h</option>
									<option value="6" selected="selected">06h</option>
									<option value="7">07h</option>
									<option value="8">08h</option>
									<option value="9">09h</option>
									<option value="10">10h</option>
									<option value="11">11h</option>
									<option value="12">12h</option>
									<option value="13">13h</option>
									<option value="14">14h</option>
									<option value="15">15h</option>
									<option value="16">16h</option>
									<option value="17">17h</option>
									<option value="18">18h</option>
									<option value="19">19h</option>
									<option value="20">20h</option>
									<option value="21">21h</option>
									<option value="22">22h</option>
									<option value="23">23h</option>
								</select>
							</fieldset>
						</div>
					</fieldset>
					<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
						<legend>Hourly Vibration:</legend>
						<input type="radio" name="c_vibr_hr" id="c_vibr_hr0" value="0" checked="checked">
						<label for="c_vibr_hr0">off</label>
						<input type="radio" name="c_vibr_hr" id="c_vibr_hr1" value="1">
						<label for="c_vibr_hr1">1x</label>
						<input type="radio" name="c_vibr_hr" id="c_vibr_hr2" value="2">
						<label for="c_vibr_hr2">2x</label>
						<input type="radio" name="c_vibr_hr" id="c_vibr_hr3" value="3">
						<label for="c_vibr_hr3">3x</label>
						<input type="radio" name="c_vibr_hr" id="c_vibr_hr4" value="4">
						<label for="c_vibr_hr4">long</label>
						<input type="radio" name="c_vibr_hr" id="c_vibr_hr5" value="5">
						<label for="c_vibr_hr5">subtle</label>
						<input type="radio" name="c_vibr_hr" id="c_vibr_hr6" value="6">
						<label for="c_vibr_hr6">less subtle</label>
						<input type="radio" name="c_vibr_hr" id="c_vibr_hr7" value="7">
						<label for="c_vibr_hr7">not subtle</label>
						<input type="radio" name="c_vibr_hr" id="c_vibr_hr8" value="8">
						<label for="c_vibr_hr8">S-S-L-S-S</label>
					</fieldset>
					<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
						<legend>Disconnect Vibration:</legend>
						<input type="radio" name="c_vibr_bl" id="c_vibr_bl0" value="0">
						<label for="c_vibr_bl0">off</label>
						<input type="radio" name="c_vibr_bl" id="c_vibr_bl1" value="1">
						<label for="c_vibr_bl1">1x</label>
						<input type="radio" name="c_vibr_bl" id="c_vibr_bl2" value="2">
						<label for="c_vibr_bl2">2x</label>
						<input type="radio" name="c_vibr_bl" id="c_vibr_bl3" value="3">
						<label for="c_vibr_bl3">3x</label>
						<input type="radio" name="c_vibr_bl" id="c_vibr_bl4" value="4">
						<label for="c_vibr_bl4">long</label>
						<input type="radio" name="c_vibr_bl" id="c_vibr_bl5" value="5" checked="checked">
						<label for="c_vibr_bl5">subtle</label>
						<input type="radio" name="c_vibr_bl" id="c_vibr_bl6" value="6">
						<label for="c_vibr_bl6">less subtle</label>
						<input type="radio" name="c_vibr_bl" id="c_vibr_bl7" value="7">
						<label for="c_vibr_bl7">not subtle</label>
						<input type="radio" name="c_vibr_bl" id="c_vibr_bl8" value="8">
						<label for="c_vibr_bl8">S-S-L-S-S</label>
					</fieldset>
					<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
						<legend>Connect Vibration:</legend>
						<input type="radio" name="c_vibr_bc" id="c_vibr_bc0" value="0" checked="checked">
						<label for="c_vibr_bc0">off</label>
						<input type="radio" name="c_vibr_bc" id="c_vibr_bc1" value="1">
						<label for="c_vibr_bc1">1x</label>
						<input type="radio" name="c_vibr_bc" id="c_vibr_bc2" value="2">
						<label for="c_vibr_bc2">2x</label>
						<input type="radio" name="c_vibr_bc" id="c_vibr_bc3" value="3">
						<label for="c_vibr_bc3">3x</label>
						<input type="radio" name="c_vibr_bc" id="c_vibr_bc4" value="4">
						<label for="c_vibr_bc4">long</label>
						<input type="radio" name="c_vibr_bc" id="c_vibr_bc5" value="5">
						<label for="c_vibr_bc5">subtle</label>
						<input type="radio" name="c_vibr_bc" id="c_vibr_bc6" value="6">
						<label for="c_vibr_bc6">less subtle</label>
						<input type="radio" name="c_vibr_bc" id="c_vibr_bc7" value="7">
						<label for="c_vibr_bc7">not subtle</label>
						<input type="radio" name="c_vibr_bc" id="c_vibr_bc8" value="8">
						<label for="c_vibr_bc8">S-S-L-S-S</label>
					</fieldset>
 				</div>
				<div data-role="collapsible" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" data-mini="true" data-collapsed="true">
					<h4>Miscellaneous</h4>
					<fieldset class="ui-grid-a">
						<div class="ui-block-a"> 
							<legend>Enable Debug Mode:</legend>
							<select name="c_debug" id="c_debug" data-background="" data-role="slider">
								<option value="0" selected="">No</option>
								<option value="1">Yes</option>
							</select>
						</div>
						<div class="ui-block-b"> 
							<legend>High Contrast Mode:</legend>
							<select name="c_hc_mode" id="c_hc_mode" data-background="" data-role="slider">
								<option value="0" selected="">No</option>
								<option value="1">Yes</option>
							</select>
						</div>
					</fieldset>
 				</div>
				<div data-role="footer" data-theme="a" data-position="fixed" style="background: #3388cc">
					<div data-role="navbar" data-mini="false" data-iconpos="left">
						<ul>
							<li><button type="submit" data-theme="b" id="b-cancel" data-icon="delete">Cancel</button></li>
							<li><button type="submit" data-theme="b"  style="background: green" id="b-submit" data-icon="check">Save</button></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<script>
			<!-- from http://snipplr.com/view/26662/get-url-parameters-with-jquery--improved/ -->
			$.urlParam = function(name) {
				var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
				if (!results) 
					return '';
				return results[1] || '';
			}

			function updateControls() {
				var title = decodeURIComponent($.urlParam("title"));
				var ampm = decodeURIComponent($.urlParam("ampm"));
				var smart = decodeURIComponent($.urlParam("smart"));
				var firstwd = decodeURIComponent($.urlParam("firstwd"));
				var grid = decodeURIComponent($.urlParam("grid"));
				var invert = decodeURIComponent($.urlParam("invert"));
				var showmy = decodeURIComponent($.urlParam("showmy"));
				var showwn = decodeURIComponent($.urlParam("showwn"));
				var wnoffs = decodeURIComponent($.urlParam("wnoffs"));
				var preweeks = decodeURIComponent($.urlParam("preweeks"));
				var weather = decodeURIComponent($.urlParam("weather"));
				var units = decodeURIComponent($.urlParam("units"));
				var weather_fc = decodeURIComponent($.urlParam("weather_fc"));
				var weather_aso = decodeURIComponent($.urlParam("weather_aso"));
				var update = decodeURIComponent($.urlParam("update"));
				var cityid = decodeURIComponent($.urlParam("cityid"));
				var col_bg = decodeURIComponent($.urlParam("col_bg"));
				var col_calbg = decodeURIComponent($.urlParam("col_calbg"));
				var col_calgr = decodeURIComponent($.urlParam("col_calgr"));
				var col_caltx = decodeURIComponent($.urlParam("col_caltx"));
				var col_calwn = decodeURIComponent($.urlParam("col_calwn"));
				var col_calhl = decodeURIComponent($.urlParam("col_calhl"));
				var col_calmy = decodeURIComponent($.urlParam("col_calmy"));
				var vibr_all = decodeURIComponent($.urlParam("vibr_all"));
				var quietf = decodeURIComponent($.urlParam("quietf"));
				var quiett = decodeURIComponent($.urlParam("quiett"));
				var vibr_hr = decodeURIComponent($.urlParam("vibr_hr"));
				var vibr_bl = decodeURIComponent($.urlParam("vibr_bl"));
				var vibr_bc = decodeURIComponent($.urlParam("vibr_bc"));
				var debug = decodeURIComponent($.urlParam("debug"));
				var hc_mode = decodeURIComponent($.urlParam("hc_mode"));
				
				$("[data-role='header'] h1").text(title+' Configuration');

				if (ampm)
					$("#c_ampm").val(ampm).slider("refresh");
				if (smart)
					$("#c_smart").val(smart).slider("refresh");
				if (firstwd)
					$("#c_firstwd").val(firstwd).slider("refresh");
				if (grid)
					$("#c_grid").val(grid).slider("refresh");
				if (invert)
					$("#c_invert").val(invert).slider("refresh");
				if (showmy)
					$("#c_showmy").val(showmy).slider("refresh");
				if (showwn)
					$("#c_showwn").val(showwn).slider("refresh");
				if (wnoffs)
					$("#c_wnoffs").val(wnoffs).selectmenu('refresh');
				if (preweeks)
				{
					$("input[name='c_preweeks'][value='"+preweeks+"']").attr("checked","checked").checkboxradio("refresh");
					$("input[name='c_preweeks']").checkboxradio("refresh");
				}
				if (weather)
					$("#c_weather").val(weather).slider("refresh");
				if (units)
					$("#c_units").val(units).slider("refresh");
				if (weather_fc)
					$("#c_weather_fc").val(weather_fc).slider("refresh");
				if (weather_aso)
					$("#c_weather_aso").val(weather_aso).slider("refresh");
				if (update)
					$('#c_update').val(update).selectmenu('refresh');
				if (cityid)
					$("#c_cityid").val(cityid).textinput('refresh');
				if (vibr_all)
					$("#c_vibr_all").val(vibr_all).slider("refresh");
				if (quietf)
					$('#c_quietf').val(quietf).selectmenu('refresh');
				if (quiett)
					$('#c_quiett').val(quiett).selectmenu('refresh');
				if (vibr_hr)
				{
					$("input[name='c_vibr_hr'][value='"+vibr_hr+"']").attr("checked","checked").checkboxradio("refresh");
					$("input[name='c_vibr_hr']").checkboxradio("refresh");
				}
				if (vibr_bl)
				{
					$("input[name='c_vibr_bl'][value='"+vibr_bl+"']").attr("checked","checked").checkboxradio("refresh");
					$("input[name='c_vibr_bl']").checkboxradio("refresh");
				}
				if (vibr_bc)
				{
					$("input[name='c_vibr_bc'][value='"+vibr_bc+"']").attr("checked","checked").checkboxradio("refresh");
					$("input[name='c_vibr_bc']").checkboxradio("refresh");
				}
				if (debug)
					$("#c_debug").val(debug).slider("refresh");
				if (hc_mode)
					$("#c_hc_mode").val(hc_mode).slider("refresh");

				//Configure color picks, use Pebble Color Table
				var ColorArray = [
					["#000000","#000055","#0000AA","#0000FF","#005500","#005555","#0055AA","#0055FF"],
					["#00AA00","#00AA55","#00AAAA","#00AAFF","#00FF00","#00FF55","#00FFAA","#00FFFF"],
					["#550000","#550055","#5500AA","#5500FF","#555500","#555555","#5555AA","#5555FF"],
					["#55AA00","#55AA55","#55AAAA","#55AAFF","#55FF00","#55FF55","#55FFAA","#55FFFF"],
					["#AA0000","#AA0055","#AA00AA","#AA00FF","#AA5500","#AA5555","#AA55AA","#AA55FF"],
					["#AAAA00","#AAAA55","#AAAAAA","#FFFFFF","#AAAAFF","#AAFF00","#AAFF55","#AAFFAA"],
					["#AAFFFF","#FF0000","#FF0055","#FF00AA","#FF00FF","#FF5500","#FF5555","#FF55AA"],
					["#FF55FF","#FFAA00","#FFAA55","#FFAAAA","#FFAAFF","#FFFF00","#FFFF55","#FFFFAA"]
				];

				if (!col_bg)
					col_bg = '000000';
				$("#c_col_bg").spectrum({
					preferredFormat: "hex",
					showPaletteOnly: true,
					showPalette:true,
					hideAfterPaletteSelect:false,
					color: col_bg,
					palette: ColorArray
				});		

				if (!col_calbg)
					col_calbg = '000055';
				$("#c_col_calbg").spectrum({
					preferredFormat: "hex",
					showPaletteOnly: true,
					showPalette:true,
					hideAfterPaletteSelect:false,
					color: col_calbg,
					palette: ColorArray
				});		

				if (!col_calgr)
					col_calgr = 'AAAAAA';
				$("#c_col_calgr").spectrum({
					preferredFormat: "hex",
					showPaletteOnly: true,
					showPalette:true,
					hideAfterPaletteSelect:false,
					color: col_calgr,
					palette: ColorArray
				});		

				if (!col_caltx)
					col_caltx = 'FFFFFF';
				$("#c_col_caltx").spectrum({
					preferredFormat: "hex",
					showPaletteOnly: true,
					showPalette:true,
					hideAfterPaletteSelect:false,
					color: col_caltx,
					palette: ColorArray
				});		

				if (!col_calwn)
					col_calwn = 'AAAAAA';
				$("#c_col_calwn").spectrum({
					preferredFormat: "hex",
					showPaletteOnly: true,
					showPalette:true,
					hideAfterPaletteSelect:false,
					color: col_calwn,
					palette: ColorArray
				});

				if (!col_calhl)
					col_calhl = 'FFFFFF';
				$("#c_col_calhl").spectrum({
					preferredFormat: "hex",
					showPaletteOnly: true,
					showPalette:true,
					hideAfterPaletteSelect:false,
					color: col_calhl,
					palette: ColorArray
				});		

				if (!col_calmy)
					col_calmy = 'FFFFFF';
				$("#c_col_calmy").spectrum({
					preferredFormat: "hex",
					showPaletteOnly: true,
					showPalette:true,
					hideAfterPaletteSelect:false,
					color: col_calmy,
					palette: ColorArray
				});		
			}
		  
			function saveOptions() {
				var options = {
					'ampm': $("#c_ampm").val(),
					'smart': $("#c_smart").val(),
					'firstwd': $('#c_firstwd').val(),
					'grid': $("#c_grid").val(),
					'invert': $('#c_invert').val(),
					'showmy': $('#c_showmy').val(),
					'showwn': $('#c_showwn').val(),
					'wnoffs': $('#c_wnoffs').val(),
					'preweeks': $("input[name='c_preweeks']:checked").val(),
					'weather': $("#c_weather").val(),
					'units': $('#c_units').val(),
					'weather_fc': $("#c_weather_fc").val(),
					'weather_aso': $("#c_weather_aso").val(),
					'update': $("#c_update").val(),
					'cityid': $('#c_cityid').val(),
					'col_bg': $("#c_col_bg").spectrum("get").toHex(),
					'col_calbg': $("#c_col_calbg").spectrum("get").toHex(),
					'col_calgr': $("#c_col_calgr").spectrum("get").toHex(),
					'col_caltx': $("#c_col_caltx").spectrum("get").toHex(),
					'col_calwn': $("#c_col_calwn").spectrum("get").toHex(),
					'col_calhl': $("#c_col_calhl").spectrum("get").toHex(),
					'col_calmy': $("#c_col_calmy").spectrum("get").toHex(),
					'vibr_all': $("#c_vibr_all").val(),
					'quietf': $("#c_quietf").val(),
					'quiett': $("#c_quiett").val(),
					'vibr_hr': $("input[name='c_vibr_hr']:checked").val(),
					'vibr_bl': $("input[name='c_vibr_bl']:checked").val(),
					'vibr_bc': $("input[name='c_vibr_bc']:checked").val(),
					'debug': $("#c_debug").val(),
					'hc_mode': $("#c_hc_mode").val()
				}
				return options;
			}

			// Workaround to work with CloudPebble
			function getQueryParam(variable, default_) {
				var query = location.search.substring(1);
				var vars = query.split('&');
				for (var i = 0; i < vars.length; i++) {
					var pair = vars[i].split('=');
					if (pair[0] == variable)
						return decodeURIComponent(pair[1]);
				}
				return default_ || false;
			}	  
		  
			$().ready(function() {
				$("#b-cancel").click(function() {
					console.log("Cancel");
					var return_to = getQueryParam('return_to', 'pebblejs://close#');
					document.location = return_to;
				});

				$("#b-submit").click(function() {
					console.log("Submit");
					var return_to = getQueryParam('return_to', 'pebblejs://close#');
					var location = return_to + encodeURIComponent(JSON.stringify(saveOptions()));
					console.log(location);
					document.location = location;
				});
			});

			$.fn.fix_radios = function() {
				function focus() {
					if ( !this.checked ) 
						return;
					if ( !this.was_checked ) {
						$( this ).change();
					}
				};

				function change( e ) {
					if ( this.was_checked ) {
						e.stopImmediatePropagation();
						return;
					}
					$( "input[name=" + this.name + "]" ).each( function() {
						this.was_checked = this.checked;
					});
				}
			
				return this.focus( focus ).change( change );
			}

			$('#page1').bind('pageinit', updateControls);
		</script>
	</body>
</html>
